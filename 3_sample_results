/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var experiments = ee.ImageCollection("projects/sites-project/conditionassessment_experiments_v5-2_results"),
    ct_burlap = ee.FeatureCollection("projects/ee-valeriepasquarella/assets/CT-GM/FEN_BurlapSurvey_Coords");
/***** End of imports. If edited, may not auto-convert in the playground. *****/


// function to convert image collection into stack of image bands
function collectionToImage(collection){
  var stack = ee.Image(collection.iterate(function(img, prev) {
    var score = img.select('score_mean')
    var index = ee.String(img.get('system:index'))
    score = score.rename(index)
    return ee.Image(prev).addBands(score);
  }, ee.Image(1)));

  stack = stack.select(ee.List.sequence(1, stack.bandNames().size().subtract(1)));
  return stack;
}


var reanalysis_cn = 'reanalysis_' + YEAR
if (YEAR >= 2015 & YEAR <= 2018) {
  var reanalysis_fn = 'projects/ee-valeriepasquarella/assets/ForestCondition/' + YEAR + '_reanalysis_meanresiduals'
  var reanalysis = ee.Image(reanalysis_fn).reproject('EPSG:5070').rename(reanalysis_cn)
} else {
  var reanalysis = ee.Image.constant(NODATA).rename(reanalysis_cn)
}


// create single image from collection
var scoreImage = collectionToImage(experiments);
print(experiments)

// sample the features
var result = scoreImage.reduceRegions(ct_burlap,ee.Reducer.mean());

Map.addLayer(ct_burlap, {}, 'points');
Map.addLayer(scoreImage)

// print the output
print(result);