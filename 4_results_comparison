/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var ct_burlap = ee.FeatureCollection("projects/ee-valeriepasquarella/assets/CT-GM/FEN_BurlapSurvey_Coords"),
    ma_quabbin = ee.FeatureCollection("projects/ee-valeriepasquarella/assets/HF-GM/PlotDefHarvSimple"),
    wrs2 = ee.FeatureCollection("projects/ee-valeriepasquarella/assets/wrs2_descending");
/***** End of imports. If edited, may not auto-convert in the playground. *****/


var RESULTS_COLLECTION = ee.ImageCollection('projects/sites-project/conditionassessment_experiments_v5-2_results_filtered')

var YEAR = 2017

// Colorbar
var min = -4;
var max = 0;
var palette = ['red', 'orange', 'yellow', 'blue']
var viz = {min: min, max: max, palette: palette};

// Mask
var gfc = ee.Image("UMD/hansen/global_forest_change_2018_v1_6")
var gfc_tcc = 75;

var gfc_mask = gfc.select('treecover2000')
  .gte(gfc_tcc)
  .reproject('EPSG:5070', null, 30)

// Get results for selected year
var selectedResults = RESULTS_COLLECTION.filterMetadata('monitor_year', 'equals', YEAR)
var NUM_RESULTS = selectedResults.size().getInfo()

  // Generate tasks for annual feature set exports
for(var RESULT = 0; RESULT < NUM_RESULTS; RESULT++){

  var assessment = ee.Image(selectedResults.toList(selectedResults.size()).get(RESULT))
  var assessment_masked = assessment.updateMask(gfc_mask)
  var result_name = assessment.get('system:index')
  var layer_name = ee.String(result_name).split('_' + YEAR).get(0).getInfo()

  Map.addLayer(assessment_masked.select('score_mean'), viz, layer_name, false)
    
}


var ct_bounds = ee.Image().byte().paint({
  featureCollection: ct_burlap.geometry().bounds(),
  color: 1,
  width: 3
});

var ma_bounds = ee.Image().byte().paint({
  featureCollection: ma_quabbin.geometry().bounds(),
  color: 1,
  width: 3
});


Map.addLayer(wrs2,{}, 'WRS2', false)

Map.addLayer(ct_bounds, {}, 'CT plots - bounds')
Map.addLayer(ma_bounds, {}, 'MA plots - bounds')

Map.addLayer(ct_burlap, {color: 'white'}, 'CT plots')
Map.addLayer(ma_quabbin, {color: 'white'}, 'MA plots')


var style = {
  'Figure': [{
      featureType: 'all',
      stylers: [{ color: '#000000'}]
  }]
};

// Set map options.
Map.setOptions(null, style);
Map.setOptions('SATELLITE')

